<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="https://qtrypzzcjebvfcihiynt.supabase.co/storage/v1/object/public/base44-prod/public/d644f855b_smalllogo.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Video Review App</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
    
    <!-- Paddle.js Integration -->
    <script src="https://cdn.paddle.com/paddle/v2/paddle.js"></script>
    <script type="text/javascript">
      // Paddle configuration
      const PADDLE_CONFIG = {
        // Use production environment since you have live tokens
        environment: 'production',
        token: 'live_78bfb05443070c51ce8ee3aa7e8', // Your Paddle live token
        environmentKey: 'apikey_01k3zv10jzrjp00ahsrpxxwdcr', // Your Paddle environment key
        
        // Flag to check if Paddle is properly configured
        isConfigured: true // Set to true since we have real tokens now
      };

      // Price IDs for different plans (your actual Paddle price IDs)
      const PADDLE_PRICES = {
        basic_monthly: 'pri_01k3k3fjtdf6wy1ktr7m0f7pgr',    // $17.00/month - Editable Basic Monthly
        basic_annual: 'pri_01k3k3webfm5f6pkvddezw46tn',     // $169.00/year - Editable Basic Annual
        pro_monthly: 'pri_01k3k3jdvrmxq42xr5sj22mnc8',      // $29.00/month - Editable Pro Monthly
        pro_annual: 'pri_01k3k400egk5x3kbw1453v8fyz'        // $289.00/year - Editable Pro Annual
      };

      // Initialize Paddle
      try {
        Paddle.Environment.set(PADDLE_CONFIG.environment);
        Paddle.Initialize({
          token: PADDLE_CONFIG.token,
          checkout: {
            settings: {
              displayMode: "overlay", // Can be "overlay" or "inline"
              theme: "dark",
              locale: "en"
            }
          }
        });
        console.log('âœ… Paddle initialized:', PADDLE_CONFIG.environment);
        console.log('ğŸ”‘ Using token:', PADDLE_CONFIG.token.substring(0, 10) + '...');
      } catch (error) {
        console.error('âŒ Paddle initialization failed:', error);
      }

      // Payment functions for the app
      window.guardedBuy = async (priceKey, planId) => {
        console.log('ğŸ”„ Processing payment for:', planId, 'with price key:', priceKey);
        console.log('ğŸ”§ Paddle config check - isConfigured:', PADDLE_CONFIG.isConfigured);
        
        try {
          // Check if Paddle is properly configured
          if (!PADDLE_CONFIG.isConfigured) {
            console.warn('âš ï¸ Paddle is not configured with real tokens and price IDs');
            alert('ğŸ’³ Payment System Setup Required\n\nThe payment system needs to be configured with:\nâ€¢ Real Paddle API tokens\nâ€¢ Valid price IDs\nâ€¢ Webhook endpoints\n\nContact the administrator to complete the setup.');
            return;
          }

          const priceId = PADDLE_PRICES[priceKey];
          if (!priceId || priceId.includes('YOUR_') || priceId.includes('_ID')) {
            console.warn('âš ï¸ Price ID not configured for:', priceKey);
            alert('ğŸ’³ Price Configuration Required\n\nThe price ID for "' + priceKey + '" is not configured.\n\nPlease provide the actual Paddle Price IDs from your Paddle Dashboard.\n\nGo to: Paddle Dashboard > Catalog > Products > [Your Product] > Copy Price ID');
            return;
          }

          const user = window.currentUser || { email: 'user@example.com' };

          const checkoutData = {
            items: [{ priceId: priceId, quantity: 1 }],
            customer: {
              email: user.email
            },
            customData: {
              planId: planId,
              userId: user.id || 'unknown'
            }
          };

          console.log('ğŸš€ Opening Paddle checkout:', checkoutData);
          Paddle.Checkout.open(checkoutData);
          
        } catch (error) {
          console.error('âŒ Payment error:', error);
          alert('ğŸ’³ Payment Error\n\n' + error.message + '\n\nPlease contact support if this issue persists.');
        }
      };

      window.goManageBilling = async () => {
        try {
          // In a real implementation, you'd get the customer ID from your database
          const user = window.currentUser || {};
          
          if (!user.paddleCustomerId) {
            alert('No billing information found. Please contact support.');
            return;
          }

          // Open Paddle billing portal
          // Note: This requires the customer management feature to be enabled in Paddle
          console.log('ğŸ¦ Opening billing management for customer:', user.paddleCustomerId);
          
          // For now, redirect to a billing management page or show instructions
          alert('ğŸ¦ Billing Management\n\nTo manage your subscription:\nâ€¢ Cancel or modify your plan\nâ€¢ Update payment methods\nâ€¢ View billing history\n\nContact support for assistance.');
          
        } catch (error) {
          console.error('âŒ Billing management error:', error);
          alert('Unable to access billing management. Please contact support.');
        }
      };

          // Listen for Paddle events (updated API)
          if (Paddle.Checkout && Paddle.Checkout.on) {
            Paddle.Checkout.on('checkout.completed', (data) => {
              console.log('âœ… Payment completed:', data);
              alert('ğŸ‰ Payment successful!\n\nYour subscription is being activated. You may need to refresh the page to see changes.');
              setTimeout(() => {
                window.location.reload();
              }, 2000);
            });

            Paddle.Checkout.on('checkout.closed', (data) => {
              console.log('âŒ Checkout closed:', data);
            });

            Paddle.Checkout.on('checkout.error', (error) => {
              console.error('âŒ Checkout error:', error);
              alert('Payment error occurred. Please try again.');
            });
          } else {
            console.log('ğŸ”„ Paddle Checkout events not available in this version');
          }

      console.log('ğŸ¯ Paddle payment system loaded');
      console.log('ğŸ’¡ Environment:', PADDLE_CONFIG.environment);
      console.log('ğŸ”‘ Available price keys:', Object.keys(PADDLE_PRICES));
    </script>
  </body>
</html>
